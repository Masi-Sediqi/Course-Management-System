{% extends 'base.html' %}
{% block content %}
{% load static %}

<div class="main-content pt-4" style="font-family: 'Vazirmatn', sans-serif;">
  <div class="row">
    <div class="col-md-12">
      <ul class="nav nav-tabs justify-content-end mb-4" id="myTab" role="tablist">
      </ul>
      <div class="card">
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade show active" id="invoice" role="tabpanel" aria-labelledby="invoice-tab">

            <form class="row g-3 needs-validation" novalidate method="post"
              action="{% url 'students:edit_paid_fees' id=fess_id.id %}">
              {% csrf_token %}

              <!-- تاریخ -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <label class="col-sm-4 col-form-label">تاریخ<span class="text-danger">*</span></label>
                <div class="col-sm-8">
                  {{ form.date }}
                </div>
              </div>
              <!-- تاریخ -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <label class="col-sm-4 col-form-label">تاریخ ختم<span class="text-danger">*</span></label>
                <div class="col-sm-8">
                  {{ form.end_date }}
                </div>
              </div>

              <!-- فیس اصلی -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <label class="col-sm-4 col-form-label">
                  فیس اصلی <span class="text-danger">*</span>
                </label>
                <div class="col-sm-8">
                  <input type="number" id="total_fees" value="{{ fess_id.orginal_fees }}" name="orginal_fees"
                    class="form-control" readonly>
                </div>
              </div>

              <!-- پرداخت -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <label class="col-sm-4 col-form-label">
                  پرداخت <span class="text-danger">*</span>
                </label>
                <div class="col-sm-8">
                  <input type="number" name="paid_fees" id="paid_amount" class="form-control" required value="{{ fess_id.give_fees }}">
                </div>
              </div>

              <!-- باقی مانده -->
              <div class="col-md-12 d-flex align-items-center mb-2">
                <label class="col-sm-4 col-form-label">
                  باقی مانده
                </label>
                <div class="col-sm-8">
                  <input type="number" name="remaining" id="remaining_amount" class="form-control" readonly value="{{ fess_id.remain_fees }}">
                </div>
              </div>

              <!-- بخشیدن باقی مانده -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <div class="col-sm-4"></div>
                <div class="col-sm-8 form-check">
                  <input class="form-check-input" type="checkbox" id="waive_remaining" name="waive_remaining">
                  <label class="form-check-label" for="waive_remaining" style="padding-right: 22px;">
                    باقی مانده بخشیده شود
                  </label>
                </div>
              </div>

              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  $('#datepicker3').datepicker({});
                });
              </script>
              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  $('#datepicker4').datepicker({});
                });
              </script>

              <script>
                const totalFees = document.getElementById('total_fees');
                const paidAmount = document.getElementById('paid_amount');
                const remainingAmount = document.getElementById('remaining_amount');
                const waiveCheckbox = document.getElementById('waive_remaining');

                function calculateRemaining() {
                  let total = parseFloat(totalFees.value) || 0;
                  let paid = parseFloat(paidAmount.value) || 0;

                  let remaining = total - paid;
                  if (remaining < 0) remaining = 0;

                  remainingAmount.value = remaining;
                }

                paidAmount.addEventListener('input', function () {
                  waiveCheckbox.checked = false;
                  remainingAmount.readOnly = true;
                  calculateRemaining();
                });

                waiveCheckbox.addEventListener('change', function () {
                  if (this.checked) {
                    remainingAmount.value = 0;
                  } else {
                    calculateRemaining();
                  }
                });
              </script>

              <!-- توضیحات -->
              <div class="col-md-12 d-flex align-items-center mb-3">
                <label class="col-sm-4 col-form-label">توضیحات</label>
                <div class="col-sm-8">
                  {{ form.description }}
                </div>
              </div>

              <!-- Submit Buttons -->
              <div class="col-12 d-flex justify-content-end mt-3">
                <input type="hidden" name="form_type" value="givefees">
                <button type="button" class="btn btn-secondary ml-2" onclick="window.history.back()">
                  منصرف
                </button>
                <button class="btn btn-primary" type="submit">
                  <i class="fas fa-save ml-2"></i>ثبت پرداخت
                </button>
              </div>
            </form>

            <script>
              document.addEventListener('DOMContentLoaded', function () {
                $('#datepicker3').datepicker({});
              });
            </script>

            <!-- ====== / Edit Station Form ====== -->
          </div>

        </div>
      </div>
    </div>
  </div><!-- end of main-content -->
</div>

{% endblock %}