{% extends 'base.html' %}
{% block content %}
{% load static %}

<div class="main-content pt-4" style="font-family: XW_Zar_Bd_0;">
    <div class="row">
        <div class="col-md-12">
            <ul class="nav nav-tabs justify-content-end mb-4" id="myTab" role="tablist">
            </ul>
<div class="card">
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="invoice" role="tabpanel" aria-labelledby="invoice-tab">
      <!-- ====== Edit Teacher Salary Form ====== -->
      <form method="POST" action="{% url 'teachers:edit_teacher_salary_record' salary_id=salary_id.id %}">
        {% csrf_token %}
        <div class="modal-dialog modal-lg">
          <div class="modal-content p-3">
            <div class="card-title h5 mb-3">ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ø¹Ø§Ø´</div>

            <!-- ğŸ§¾ Display current loan information -->
            {% if total_teacher_loan %}
            <div class="alert alert-info text-center" style="font-weight: 500;">
              Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø±Ø¶ Ø§ÛŒÙ† Ø§Ø³ØªØ§Ø¯: <span class="text-danger">{{ total_teacher_loan.total_loan_amount }}</span>
            </div>
            {% else %}
            <div class="alert alert-secondary text-center">Ø§ÛŒÙ† Ø§Ø³ØªØ§Ø¯ Ù‚Ø±Ø¶ Ù†Ø¯Ø§Ø±Ø¯</div>
            {% endif %}

            <div class="row">
              <div class="col-md-4 form-group mb-3">
                <label for="{{ form.date.id_for_label }}">ØªØ§Ø±ÛŒØ®</label>
                {{ form.date }}
              </div>

              <div class="col-md-4 form-group mb-3">
                <label for="{{ form.amount_of_fees_bell.id_for_label }}">ØªØ¹Ø¯Ø§Ø¯ ÙÛŒØ³ Ø¨Ù„</label>
                {{ form.amount_of_fees_bell }}
              </div>

              <div class="col-md-4 form-group mb-3 position-relative">
                <label for="{{ form.amount.id_for_label }}">Ù…Ù‚Ø¯Ø§Ø± <span class="text-danger">*</span></label>
                {{ form.amount }}
                <div id="warning-msg" class="text-danger mt-1" style="display: none;">
                  Ù…Ù‚Ø¯Ø§Ø± ÙÛŒØ³ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ø±Ú¯ØªØ± Ø§Ø² Ù…Ù‚Ø¯Ø§Ø± Ø§ØµÙ„ÛŒ ÙÛŒØ³ Ø¨Ø§Ø´Ø¯!
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Loan deduction input -->
              <div class="col-md-4 form-group mb-3">
                <label for="loan_amount">Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø±Ø¶ Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø±</label>
                <input type="number"
                       id="loan_amount"
                       name="loan_amount"
                       class="form-control"
                       value="{{ salary_id.loan_amount|default:0 }}"
                       max="{{ total_teacher_loan.total_loan_amount|add:salary_id.loan_amount|default:0 }}"

                       step="0.01">
                <div id="loan-warning-msg" class="text-danger mt-1" style="display: none;">
                  Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø±Ø¶ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ù‚Ø±Ø¶ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª!
                </div>
              </div>

              <div class="col-md-4 form-group mb-3">
                <label for="{{ form.paid_salary.id_for_label }}">Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª</label>
                {{ form.paid_salary }}
              </div>
            </div>

            <div class="col-md-12 form-group mb-3">
              <label for="{{ form.description.id_for_label }}">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
              {{ form.description }}
            </div>

            <div class="text-end">
              <a href="{{ referer }}" class="btn btn-secondary mt-2">Ø¨Ø±Ú¯Ø´Øª</a>
              <button class="btn btn-primary mt-2" type="submit">Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù†</button>
            </div>
          </div>
        </div>
      </form>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          // Initialize datepicker if you are using one
          if (typeof $ !== "undefined" && $("#datepicker3").length) {
            $("#datepicker3").datepicker({});
          }

          const amountInput = document.getElementById("id_amount");
          const loanInput = document.getElementById("loan_amount");
          const paidSalaryInput = document.getElementById("id_paid_salary");
          const loanWarning = document.getElementById("loan-warning-msg");
          const maxLoan = parseFloat("{{ total_teacher_loan.total_loan_amount|add:salary_id.loan_amount|default:0 }}") || 0;

          // Prevent entering loan greater than available
          loanInput.addEventListener("input", function () {
            const value = parseFloat(loanInput.value) || 0;
            if (value > maxLoan) {
              loanWarning.style.display = "block";
              loanInput.value = maxLoan;
            } else {
              loanWarning.style.display = "none";
            }
            updatePaidSalary();
          });

          // Update paid salary automatically
          function updatePaidSalary() {
            const amount = parseFloat(amountInput.value) || 0;
            const loan = parseFloat(loanInput.value) || 0;
            let result = amount - loan;
            if (result < 0) result = 0;
            paidSalaryInput.value = result;
          }

          amountInput.addEventListener("input", updatePaidSalary);
          updatePaidSalary();
        });
      </script>
      <!-- ====== / Edit Teacher Salary Form ====== -->
    </div>
  </div>
</div>


        </div>
    </div><!-- end of main-content -->
</div>

{% endblock %}