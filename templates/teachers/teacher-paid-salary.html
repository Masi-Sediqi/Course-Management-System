{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container-xxl flex-grow-1 container-p-y" style="font-family: XW_Zar_Bd_0;">
    <div class="main-content pt-4">
        <div class="row">
            <div class="col-md-12">
            
                    <script>
                        {% if messages %}
                            {% for message in messages %}
                                Swal.fire({
                                    toast: true,
                                    position: 'top-end',
                                    icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}",
                                    title: "{{ message|escapejs }}",
                                    showConfirmButton: false,
                                    timer: 4000,
                                    timerProgressBar: true,
                                    didOpen: (toast) => {
                                        toast.addEventListener('mouseenter', Swal.stopTimer)
                                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                                    }
                                });
                            {% endfor %}
                        {% endif %}
                    </script>
                <ul class="nav nav-tabs justify-content-end mb-4" id="myTab" role="tablist">
                    <li class="nav-item"><a class="nav-link active" id="invoice-tab" data-toggle="tab" href="#invoice" role="tab" aria-controls="invoice" aria-selected="true">
                        <button class="btn btn-dark ripple m-1" type="button"  data-toggle="modal"
                        data-target="#exampleModal">ماش جدید</button>
                    </a></li>
                    <li class="nav-item"><a href="{% url 'teachers:teacher_paid_remain_money' teacher.id %}" class="nav-link">
                        <button class="btn btn-dark ripple m-1">پرداخت ها</button>
                    </a></li>
            
                </ul>
                <div class="card">
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="invoice" role="tabpanel" aria-labelledby="invoice-tab">
                            <div class="d-sm-flex mb-5" data-view="print"><span class="m-auto"></span>
                            </div>
                            <!-- -===== Print Area =======-->
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">تاریخ</th>
                                            <th scope="col">مقدار بل</th>
                                            <th scope="col">مقدار</th>
                                            <th scope="col">مقدار پرداخت شده</th>
                                            <th scope="col">مقدار باقی مانده</th>
                                            <th scope="col">عملیات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in paid_records %}
                                        <tr>
                                            <th scope="row">{{ forloop.counter }}</th>
                                            <td>{{ i.date }}</td>
                                            <td>{{ i.amount_of_fees_bell }}</td>
                                            <td><span class="badge badge-info">{{ i.amount }}</span></td>
                                            <td><span class="badge badge-success">{{ i.paid_salary }}</span></td>
                                            <td><span class="badge badge-warning">{{ i.remain_salary }}</span></td>
                                            <td>
                                                <a class="text-success mr-2" href="#"><i class="nav-icon i-Pen-2 font-weight-bold"></i></a>
                                                <a class="text-danger mr-2" href="#"><i class="nav-icon i-Close-Window font-weight-bold"></i></a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="5" class="text-right font-weight-bold">مجموع مقدار باقی مانده:</td>
                                            <td><span class="badge badge-danger">{{ total_remain_salary.total_amount }}</span></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            
                            <!-- ==== / Print Area =====-->
                        </div>
                    </div>
                </div>
            </div>
        </div><!-- end of main-content -->
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">پرداخت معاش استاد</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="بستن">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="needs-validation" novalidate action="{% url 'teachers:teacher_paid_salary' id=teacher.id %}" method="post">
                    {% csrf_token %}
                    <div class="row p-3">

                        <!-- Personal Info -->
                        <div class="col-md-3 form-group mb-3">
                            <label for="lastName1">تاریخ<span style="color: red;">*</span></label>
                            {{ form.date }}
                        </div>
                        <div class="col-md-3 form-group mb-3">
                            <label for="firstName1"> تعداد فیس بل<span style="color: red;">*</span></label>
                            {{ form.amount_of_fees_bell }}
                        </div>
                  
                        <div class="col-md-3 form-group mb-3">
                            <label for="id_amount"> مقدار<span style="color: red;">*</span></label>
                            {{ form.amount }}
                        </div>
                        
                        {% if total_teacher_loan.total_loan_amount > 0 %}
                        <div class="col-md-3 form-group mb-3">
                            <label for="loan_amount"> مقدار قرض<span style="color: red;">*</span></label>
                            <input type="number" id="loan_amount" name="loan_amount"
                                   value="{{ total_teacher_loan.total_loan_amount }}" class="form-control">
                        </div>
                        {% endif %}
                        
                        <div class="col-md-3 form-group mb-3">
                            <label for="id_paid_salary"> مقدار برای پرداخت<span style="color: red;">*</span></label>
                            {{ form.paid_salary }}
                        </div>
                        
                        <script>
                            document.addEventListener("DOMContentLoaded", function () {
                                const amountInput = document.getElementById("id_amount");
                                const loanInput = document.getElementById("loan_amount");
                                const paidSalaryInput = document.getElementById("id_paid_salary");
                        
                                function calculatePaidSalary() {
                                    let amount = parseFloat(amountInput.value) || 0;
                                    let loan = parseFloat(loanInput?.value) || 0;
                                    let result = amount - loan;
                        
                                    paidSalaryInput.value = result >= 0 ? result : 0; // don’t allow negative
                                }
                        
                                amountInput.addEventListener("input", calculatePaidSalary);
                                if (loanInput) loanInput.addEventListener("input", calculatePaidSalary);
                            });
                        </script>
                        
                        <div class="col-md-12 form-group mb-3">
                            <label for="email">توضیحات </label>
                            {{ form.description }}
                        </div>

                        <!-- Submit Buttons -->
                        <div class="col-12 modal-footer">
                            <input type="hidden" name="form_type" value="class">
                            <button class="btn btn-secondary" type="button" data-dismiss="modal">برگشت</button>
                            <button class="btn btn-primary" type="submit">ذخیره کردن</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('#datepicker3').datepicker({});
    });
</script>


</div>
{% endblock %}