{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container-xxl flex-grow-1 container-p-y" style="font-family: 'Vazirmatn', sans-serif;">
    <h4 class="py-3 mb-4">
        <span class="text-muted fw-light">داشبورد / </span> بازپسی پول قرضی - استاد "{{ teacher.name }}"
    </h4>
    

    <div class="card shadow-sm border rounded-3">
        <div class="card-body text-center">

            <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.min.css" rel="stylesheet">
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.all.min.js"></script>
        
            <script>
              
              {% if messages %}
                  {% for message in messages %}
                      Swal.fire({
                          toast: true,
                          position: 'top-end',
                          icon: "{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}",
                          title: "{{ message|escapejs }}",
                          showConfirmButton: false,
                          timer: 4000,
                          timerProgressBar: true,
                          didOpen: (toast) => {
                              toast.addEventListener('mouseenter', Swal.stopTimer)
                              toast.addEventListener('mouseleave', Swal.resumeTimer)
                          }
                      });
                  {% endfor %}
              {% endif %}
          </script>

            <div class="row align-items-center">
  
                <!-- Cart on the left -->
                <div class="col-md-6 mb-3">
                  <div class="card shadow-sm">
                    <div class="card-body">
                      <h5 class="card-title"> قرض</h5>
                      <p class="card-text">مجموع: <strong class="text-success">{{get_total_loan.total_loan_amount}} افغانی</strong></p>
                    </div>
                  </div>
                </div>
              
                <!-- Button on the right -->
                <div class="col-md-6 mb-3 d-flex justify-content-end">
                  <button class="btn btn-info" data-toggle="modal" data-target="#exampleModal">
                    پرداخت جدید
                  </button>
                </div>
              
              </div>
              

          <div class="col-md-12 mb-3">
                        <div class="card text-left">
                            <div class="card-body">
                                <!-- <h4 class="card-title mb-3"> Dark Striped Table </h4> -->
                                <p>لیست پرداخت های بازپسی</code>.</p>
                                <div class="table-responsive">
                                    <table class="table table-striped table-dark">
                                        <thead>
                                            <tr>
                                                <th scope="col">#</th>
                                                <th scope="col">تاریخ</th>
                                                <th scope="col">مقدار</th>
                                                <th scope="col">توضیحات</th>
                                                <th scope="col">عملیات</th>
                                               
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for i in teachers %}
                                            <tr>
                                                <th scope="row">{{ forloop.counter }}</th>
                                                <td>{{i.date}}</td>
                                                <td>{{i.amount}}</td>
                                                <td>{{ i.description|truncatechars:30 }}</td>

                                                <td>
                                                    <!-- Actions like edit/delete buttons go here -->
                                                    <a href="{% url 'teachers:edit_paid_total_amount' i.id %}" class="btn btn-dark text-info">تغییرات</a>
                                                    <button class="btn btn-light text-danger"
                                                    data-toggle="modal" data-target="#deleteConfirmModal{{ i.id }}">
                                                        حذف
                                                    </button> 
                                                </td>
                                            </tr>
                                            <div class="modal fade" id="deleteConfirmModal{{ i.id }}" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel{{ i.id }}" aria-hidden="true">
                                                <div class="modal-dialog modal-lg" role="document">
                                                  <div class="modal-content text-center">
                                                    <div class="modal-header">
                                                      <h5 class="modal-title w-100" id="deleteModalLabel{{ i.id }}">حذف کردن</h5>
                                                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                      </button>
                                                    </div>
                                                    <div class="modal-body">
                                                      <p class="fs-5">آیا مطمئن هستید که می‌خواهید این مورد را حذف کنید؟</p>
                                                      <div class="text-danger font-weight-bold mb-3">در حال حذف ...</div>
                                                      <div class="d-flex justify-content-center gap-2">
                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">نخیر</button>
                                                        <a href="{% url 'teachers:delete_paid_loan_amout' i.id %}" class="btn btn-danger">بلی، حذف کن</a>
                                                      </div>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>          

        </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">ثبت پرداخت جدید</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">

                <form class="needs-validation" novalidate="novalidate" action="{% url 'teachers:teacher_paid_loan_amount' teacher.id %}" method="post">
                    {% csrf_token %}
                    <div class="row">
                      
                        <!-- Personal Info -->
                        <div class="col-md-6 form-group mb-3">
                            <label for="firstName1">تاریخ<span style="color: red;">*</span></label>
                            {{ form.date }}
                        </div>
                        
                        <div class="col-md-6 form-group mb-3">
                            <label for="firstName1">مقدار<span style="color: red;">*</span></label>
                            {{ form.amount }}
                        </div>
                        
                        <div class="col-md-12 form-group mb-3">
                            <label for="gender">توضیحات</label>
                            {{ form.description }}
                        </div>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                $('#datepicker12').datepicker({});
                            });
                        </script>
                
                        <!-- Submit Buttons -->
                        <div class="col-12 modal-footer">
                        
                                <button class="btn btn-secondary" type="button" data-dismiss="modal">بستن</button>

                            <button class="btn btn-primary " type="submit">ذخیره کردن</button>
                        </div>
                    </div>
                </form>

            </div>
            
        </div>
    </div>
</div>

<!-- Search filter script -->
<script>
    document.getElementById("studentSearch").addEventListener("keyup", function () {
        let value = this.value.toLowerCase();
        let rows = document.querySelectorAll("#studentsTable tbody tr");

        rows.forEach(function (row) {
            let text = row.innerText.toLowerCase();
            row.style.display = text.includes(value) ? "" : "none";
        });
    });
</script>


</div>



{% endblock %}
